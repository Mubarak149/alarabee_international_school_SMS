{% extends "teachers/base_teacher.html" %}

{% block title %}My Profile - Teacher Dashboard{% endblock %}

{% block extra_css %}
<style>
    /* ===== PROFILE PAGE STYLES ===== */
    
    .profile-header {
        background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
        border-radius: 10px;
        color: white;
        padding: 30px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    
    .profile-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(45deg);
    }
    
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 4px solid white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        z-index: 1;
        position: relative;
    }
    
    .profile-stats {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        z-index: 1;
        position: relative;
    }
    
    .stat-card {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 15px;
        min-width: 120px;
        backdrop-filter: blur(10px);
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 14px;
        opacity: 0.9;
    }
    
    /* Profile Sections */
    .profile-section {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #eef2f7;
    }
    
    .section-title {
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #4A90E2;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .edit-btn {
        padding: 5px 15px;
        font-size: 0.875rem;
    }
    
    /* Info Grid */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }
    
    .info-item {
        margin-bottom: 15px;
    }
    
    .info-label {
        font-weight: 600;
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 5px;
    }
    
    .info-value {
        color: #2c3e50;
        font-size: 1rem;
    }
    
    .badge-status {
        font-size: 0.8rem;
        padding: 4px 12px;
        border-radius: 20px;
    }
    
    /* Subjects List */
    .subjects-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    
    .subject-badge {
        background: #e3f2fd;
        color: #1976d2;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.875rem;
        border: 1px solid #bbdefb;
    }
    
    /* Modal Styles */
    .modal-content {
        border: none;
        border-radius: 10px;
    }
    
    .modal-header {
        background: #4A90E2;
        color: white;
        border-radius: 10px 10px 0 0;
        padding: 20px;
    }
    
    .modal-title {
        font-weight: 600;
    }
    
    .modal-body {
        padding: 25px;
    }
    
    /* Form Styles */
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
    }
    
    .form-control, .form-select {
        border: 1px solid #ced4da;
        border-radius: 6px;
        padding: 10px 15px;
        transition: all 0.3s;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #4A90E2;
        box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
    }
    
    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
    }
    
    /* Status Badge Colors */
    .badge-active { background-color: #28a745; }
    .badge-inactive { background-color: #6c757d; }
    .badge-on_leave { background-color: #ffc107; color: #212529; }
    .badge-retired { background-color: #dc3545; }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
    }
    
    .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 20px;
        opacity: 0.5;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .profile-header {
            text-align: center;
            padding: 20px;
        }
        
        .profile-stats {
            flex-direction: column;
            gap: 10px;
        }
        
        .stat-card {
            min-width: auto;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .action-buttons .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1>My Profile</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'teacher_dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item active">My Profile</li>
                </ol>
            </nav>
        </div>
        <div>
            <a href="{% url 'teacher_classes' %}" class="btn btn-outline-primary">
                <i class="fas fa-chalkboard-teacher me-1"></i> View My Classes
            </a>
        </div>
    </div>
</div>

<!-- Profile Header -->
<div class="profile-header">
    <div class="row align-items-center">
        <div class="col-md-3 text-center text-md-start">
            <img src="https://ui-avatars.com/api/?name={{ teacher.user.get_full_name|urlencode }}&background=fff&color=4A90E2&size=200"
                 class="profile-avatar"
                 alt="{{ teacher.user.get_full_name }}">
        </div>
        <div class="col-md-9">
            <h2 class="mb-2">{{ teacher.user.get_full_name }}</h2>
            <p class="mb-1">
                <i class="fas fa-graduation-cap me-2"></i>
                {{ teacher.get_qualification_display }}
            </p>
            <p class="mb-0">
                <i class="fas fa-envelope me-2"></i>
                {{ teacher.user.email }}
            </p>
        </div>
    </div>
    
    <div class="profile-stats">
        <div class="stat-card">
            <div class="stat-value">{{ assigned_classes_count }}</div>
            <div class="stat-label">Assigned Classes</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ total_students_count }}</div>
            <div class="stat-label">Total Students</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ subjects_taught.count }}</div>
            <div class="stat-label">Subjects</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ current_year.year }}</div>
            <div class="stat-label">Academic Year</div>
        </div>
    </div>
</div>

<!-- Personal Information -->
<div class="profile-section">
    <div class="section-title">
        <span>Personal Information</span>
        <button type="button" class="btn btn-sm btn-primary edit-btn" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="fas fa-edit me-1"></i> Edit Profile
        </button>
    </div>
    
    <div class="info-grid">
        <div class="info-item">
            <div class="info-label">Full Name</div>
            <div class="info-value">{{ teacher.user.get_full_name }}</div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Email Address</div>
            <div class="info-value">{{ teacher.user.email }}</div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Phone Number</div>
            <div class="info-value">
                {% if teacher.contact %}
                    {{ teacher.contact }}
                {% else %}
                    <span class="text-muted">Not provided</span>
                {% endif %}
            </div>
        </div>
        
        <div class="info-item">
            <div class="info-label">National ID (NIN)</div>
            <div class="info-value">
                {% if teacher.nin %}
                    {{ teacher.nin }}
                {% else %}
                    <span class="text-muted">Not provided</span>
                {% endif %}
            </div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Qualification</div>
            <div class="info-value">{{ teacher.get_qualification_display }}</div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Status</div>
            <div class="info-value">
                <span class="badge badge-{{ teacher.status }} badge-status">
                    {{ teacher.get_status_display }}
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Subjects Taught -->
<div class="profile-section">
    <div class="section-title">
        <span>Subjects Taught</span>
    </div>
    
    {% if subjects_taught %}
        <div class="subjects-list">
            {% for subject in subjects_taught %}
                <span class="subject-badge">
                    <i class="fas fa-book me-1"></i> {{ subject.name }}
                </span>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <h5>No subjects assigned</h5>
            <p class="text-muted">You haven't been assigned to any subjects yet.</p>
        </div>
    {% endif %}
</div>

<!-- Bank Details -->
<div class="profile-section">
    <div class="section-title">
        <span>Bank Account Details</span>
        <button type="button" class="btn btn-sm btn-primary edit-btn" data-bs-toggle="modal" data-bs-target="#editBankModal">
            <i class="fas fa-edit me-1"></i> Edit Bank Details
        </button>
    </div>
    
    <div class="info-grid">
        <div class="info-item">
            <div class="info-label">Bank Name</div>
            <div class="info-value">
                {% if bank_details.bank_name %}
                    {{ bank_details.bank_name }}
                {% else %}
                    <span class="text-muted">Not provided</span>
                {% endif %}
            </div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Account Number</div>
            <div class="info-value">
                {% if bank_details.account_number %}
                    {{ bank_details.account_number }}
                {% else %}
                    <span class="text-muted">Not provided</span>
                {% endif %}
            </div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Account Name</div>
            <div class="info-value">
                {% if bank_details.account_name %}
                    {{ bank_details.account_name }}
                {% else %}
                    <span class="text-muted">Not provided</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Profile Information</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'update_teacher_profile' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Qualification</label>
                            <select name="qualification" class="form-select" required>
                                {% for value, label in teacher.QUALIFICATION_CHOICES %}
                                    <option value="{{ value }}" {% if teacher.qualification == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <select name="status" class="form-select" required>
                                {% for value, label in teacher.TEACHER_STATUS %}
                                    <option value="{{ value }}" {% if teacher.status == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Phone Number</label>
                            <input type="text" name="contact" class="form-control" 
                                   value="{{ teacher.contact|default:'' }}" 
                                   placeholder="Enter phone number">
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">National ID (NIN)</label>
                            <input type="text" name="nin" class="form-control" 
                                   value="{{ teacher.nin|default:'' }}" 
                                   placeholder="Enter national ID number">
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">Subjects</label>
                            <select name="subjects" class="form-select" multiple size="6">
                                {% for subject in all_subjects %}
                                    <option value="{{ subject.id }}" 
                                            {% if subject in teacher.subjects.all %}selected{% endif %}>
                                        {{ subject.name }}
                                    </option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Hold Ctrl (or Cmd on Mac) to select multiple subjects</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Bank Details Modal -->
<div class="modal fade" id="editBankModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Bank Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'update_bank_details' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Bank Name</label>
                        <input type="text" name="bank_name" class="form-control" 
                               value="{{ bank_details.bank_name|default:'' }}" 
                               placeholder="Enter bank name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Account Number</label>
                        <input type="text" name="account_number" class="form-control" 
                               value="{{ bank_details.account_number|default:'' }}" 
                               placeholder="Enter account number" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Account Holder Name</label>
                        <input type="text" name="account_name" class="form-control" 
                               value="{{ bank_details.account_name|default:'' }}" 
                               placeholder="Enter account holder name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Bank Details</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Handle form submissions with feedback
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            // Add loading state to submit button
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Saving...';
                submitBtn.disabled = true;
            }
        });
    });
    
    // Auto-hide success messages after 5 seconds
    setTimeout(() => {
        const alerts = document.querySelectorAll('.alert-success');
        alerts.forEach(alert => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);
});
</script>
{% endblock %}